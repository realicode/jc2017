<title>稽查数据库</title>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/fancytree/ui.fancytree.css}"
      href="../../../../static/realaicy/css/fancytree/ui.fancytree.css"/>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/smartadmin/css/realaicy.css}"
      href="../../../../static/smartadmin/css/realaicy.css"/>
<link rel="stylesheet" xmlns:th="http://www.thymeleaf.org"
      th:href="@{/realaicy/css/bootstrap-dialog.min.css}"
      href="../../../../static/realaicy/css/bootstrap-dialog.min.css"/>
<div class="row no-margin no-padding" style="height: 40px">
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4 no-margin no-padding" style="height: 40px;font-size: 16px">
        <i class="fa-fw fa fa-home"></i>
        稽查数据库管理
        <span>>
				预稽查数据库检查项管理
			</span>
    </div>
</div>
<section id="widget-grid" class="">
    <div class="alert alert-success  collapse alert-dismissible" role="alert" id="realalert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                aria-hidden="true">&times;</span></button>
        <strong>操作成功!</strong> <span id="realalertinfo"></span>
    </div>
    <div class="row">
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12" hidden="hidden" id="article_real_entity">
            <div class="jarviswidget jarviswidget-color-darken widget-realaicy" id="real_entity"
                 data-widget-editbutton="false"
                 data-widget-collapsed="false"
                 data-widget-deletebutton="false"
                 data-widget-fullscreenbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>新增 || 修改 检查项 —— 控制面板</h2>
                </header>
                <div id="realeditdiv">
                </div>
            </div>
        </article>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="jarviswidget jarviswidget-color-darken widget-realaicy" id="real_treesearch"
                 data-widget-editbutton="false"
                 data-widget-collapsed="true"
                 data-widget-deletebutton="false"
                 data-widget-fullscreenbutton="false">
                <header>
                    <span class="widget-icon"> <i class="fa fa-table"></i> </span>
                    <h2>查询预检查项</h2>
                </header>
                <div>
                    <div class="jarviswidget-editbox">
                    </div>
                    <div class="widget-body">
                        <form class="form-horizontal">
                            <fieldset>
                                <div class="form-group" align="left">
                                    <label class="col-md-2 control-label">预检查项名称</label>
                                    <div class="col-md-10">
                                        <input class="form-control" id="searchname" name="searchname"
                                               placeholder="检查项名称" type="text">
                                    </div>
                                </div>
                            </fieldset>
                            <footer>
                                <a href="javascript:void(0);" id="btnSearch2"
                                   class="btn btn-labeled btn-primary"> <span
                                        class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>查询预稽查检查项
                                </a>
                                <a href="javascript:void(0);" id="btnSearchClear"
                                   class="btn btn-labeled btn-primary"> <span
                                        class="btn-label"><i class="fa fa-recycle"></i></span>清空查询条件
                                </a>
                            </footer>
                        </form>
                        <div class="row">
                            <div class="col-sm-12">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="row no-padding no-margin">
                <div class="jarviswidget no-padding no-margin" id="wid-id-1"
                     data-widget-editbutton="false"
                     data-widget-deletebutton="false"
                     data-widget-togglebutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-comments"></i> </span>
                        <h2>预稽查检查项</h2>
                    </header>
                    <div>
                        <div class="jarviswidget-editbox">
                        </div>
                        <div class="widget-body no-padding">
                            <div class="widget-body-toolbar" style="padding-bottom: 40px">
                                <form id="realForm" method="post" class="form-horizontal">
                                    <div class="col-sm-2">
                                        <div class="input-group">
                                            <div class="input-group-btn">
                                                <a href="javascript:void(0);" id="real_btn_new"
                                                   class="btn btn-labeled btn-primary"> <span
                                                        class="btn-label"><i class="fa fa-pencil"></i></span>新增预稽查检查项
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-2">
                                        <div class="input-group">
                                            <div class="input-group-btn">
                                                <a href="javascript:void(0);" id="real_btn_edit"
                                                   class="btn btn-labeled btn-info"> <span
                                                        class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>编辑预稽查检查项
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <div class="input-group">
                                            <div class="input-group-btn">
                                                <a href="javascript:void(0);" id="btnSearch"
                                                   class="btn btn-labeled btn-primary"> <span
                                                        class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>查询预稽查检查项
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-2">
                                        <a href="javascript:void(0);" id="real_btn_del"
                                           class="btn btn-labeled btn-danger"> <span
                                                class="btn-label"><i class="glyphicon glyphicon-remove"></i></span>删除预稽查检查项
                                        </a>
                                    </div>
                                    <div class="col-sm-2">
                                        <select id='real_filter_tem' class="form-control" title="">
                                            <option value='1'>——测试模版——</option>
                                            <option value='2'>——正式模版——</option>
                                            <option value='3'>——333模版——</option>

                                        </select>
                                    </div>
                                </form>
                            </div>

                            <table id="treetable" class="table table-striped table-bordered table-hover"
                                   style="height: 100%">
                                <colgroup>
                                    <col width="30px"/>
                                    <col width="30px"/>
                                    <col width="*"/>
                                </colgroup>
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>#</th>
                                    <th>预稽查稽查项名称</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <div class="widget-footer" style="padding-bottom: 10px;margin-bottom: 10px">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div class="row no-padding no-margin">
                <div class="jarviswidget no-padding no-margin" id="wid-id-2"
                     data-widget-editbutton="false"
                     data-widget-deletebutton="false"
                     data-widget-togglebutton="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-comments"></i> </span>
                        <h2>新增模版检查项</h2>
                    </header>
                    <div>
                        <div class="jarviswidget-editbox">
                        </div>
                        <div class="widget-body no-padding">
                            <div class="widget-body-toolbar" style="padding-bottom: 40px">
                                <form id="real_form_tem" method="post" class="form-horizontal">
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <div class="input-group-btn">
                                                <a href="javascript:void(0);" id="real_btn_tem_remove"
                                                   class="btn btn-labeled btn-primary"> <span
                                                        class="btn-label"><i class="fa fa-pencil"></i></span>移除模版检查项
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <table id="real_treetable_tem" class="table table-striped table-bordered table-hover"
                                   style="height: 100%">
                                <colgroup>
                                    <col width="30px"/>
                                    <col width="30px"/>
                                    <col width="*"/>
                                </colgroup>
                                <thead>
                                <tr>
                                    <th></th>
                                    <th>#</th>
                                    <th>预稽查稽查项名称</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <div class="widget-footer" style="padding-bottom: 10px;margin-bottom: 10px">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>

    </div>

</section>
<script type="text/javascript">

    var temid = 1;

    pageSetUp();

    var pagefunction = function () {

        var realmsg = "请先选择一个父类检查项";

        var destinationTree = $("#real_treetable_tem").fancytree({
            extensions: ["table", "filter"],
            checkbox: true,
            table: {
                indentation: 20,
                nodeColumnIdx: 2,
                checkboxColumnIdx: 0
            },
            filter: {
                counter: true,
                hideExpandedCounter: true,
                mode: "hide"
            },
            renderColumns: function (event, data) {
                var node = data.node,
                    $tdList = $(node.tr).find(">td");
                $tdList.eq(1).text(node.getIndexHier()).addClass("alignRight");
            },
            activate: function (event, data) {
                var node = data.node;
                $("#nowid").text(node.title);
            }
        });


        // Sample: add an hierarchic branch using an array
        var obj = [
            {
                title: "新建未命名模版", folder: true
            }
        ];
        destinationTree.fancytree("getRootNode").addChildren(obj);



        var treeOptions = {
            extensions: ["table", "filter"],
            checkbox: true,
            selectMode: 3,
            table: {
                indentation: 20,
                nodeColumnIdx: 2,
                checkboxColumnIdx: 0
            },
            filter: {
                counter: true,
                hideExpandedCounter: true,
                mode: "hide"
            },
            source: {
                url: "/auditdb/pre/chkitem/list",
                data: {temid: temid},
                cache: false
            },
            renderColumns: function (event, data) {
                var node = data.node,
                    $tdList = $(node.tr).find(">td");
                $tdList.eq(1).text(node.getIndexHier()).addClass("alignRight");
            },
            activate: function (event, data) {
                var node = data.node;
                $("#nowid").text(node.title);
            }
        }; // initial options

        var sourceTree = $('#treetable').fancytree(treeOptions);

        $('#real_filter_tem').change(function () {
            var id = $('option:selected', this).val();

            var newSourceOption = {
                url: "/auditdb/pre/chkitem/list",
                data: {temid: id},
                cache: false,
                dataType: 'json'
            };

            var tree = $('#treetable').fancytree('getTree');
            tree.reload(newSourceOption);
        });

        $("#btnSearch").click(function () {
            if ($("#real_treesearch").hasClass("jarviswidget-collapsed"))
                $("#real_treesearch a.jarviswidget-toggle-btn").trigger("click");
        });

        $("#btnSearch2").click(function () {
            $("#treetable").fancytree("getTree").filterNodes($("input[name=searchname]").val(), {
                autoExpand: true
            });
        });

        $("#btnSearchClear").click(function () {
            $("#searchname").val("");
            $("#treetable").fancytree("getTree").clearFilter();
            $("#treetable").fancytree("getTree").reload();

        });

        $("#real_btn_new").click(function () {
            var node = $("#treetable").fancytree("getActiveNode");
            if (node === null || node === undefined || node === '') {
                realalert("请先选择一个检查项目录");
            } else {
                realloadpage("/auditdb/pre/chkitem/treenew?realtype=new&pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));
//                realloadpage("/auditdb/chkitem/new?pid=" + node.data.id + "&pname=" + encodeURIComponent(node.title));
            }
        });

        $("#real_btn_edit").click(function () {
            var node = $("#treetable").fancytree("getActiveNode");
            if (node === null || node === undefined || node === '') {
                realalert("请先选择一个检查项目录");
            } else {
                realloadpage("/auditdb/pre/chkitem/show/" + node.data.id);
            }
        });



        $("#real_btn_del").click(function () {
            var node = $("#treetable").fancytree("getActiveNode");
            if (node === null || node === undefined || node === '') {
                realalert("请先选择一条检查项");
            } else {
                BootstrapDialog.show({
                    title: '系统提示信息',
                    message: '请确认是否删除选定数据.',
                    buttons: [{
                        label: '确认删除',
                        action: function (dialog) {
                            dialog.close();
                            $("#updateflag").attr("value", 'deldel');
                            $.ajax({
                                url: '/auditdb/pre/chkitem/del/' + node.data.id,
                                type: 'GET',
                                success: function (response) {
                                    if (response.substring(0, 2) === "ok") {
                                        real_g_success("删除检查项成功！");
                                        $("#treetable").fancytree("getTree").clearFilter();
                                        $("#treetable").fancytree("getTree").reload();
                                    }
                                    else {
                                        real_g_fail(response);
                                    }
                                }
                            });
                        }
                    }, {
                        label: '取消',
                        action: function (dialogItself) {
                            dialogItself.close();
                        }
                    }]
                });
            }
        });
    };

    pagefunction();

</script>
